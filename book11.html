<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-N67L88MK');</script>
	<!-- End Google Tag Manager -->
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>Red Rock Party Rentals</title>
	<link rel="stylesheet" href="style.css" />
	<link rel="stylesheet" href="book-now-component.css" />
	<link rel="stylesheet" href="accordion.css" />
	<link rel="stylesheet" href="cart.css" />
	<!-- Lora font for all text -->
	<link href="https://fonts.googleapis.com/css2?family=Lora:wght@400&display=swap" rel="stylesheet">
	<!-- datepicker -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

	
	  <style>

	.checking-availability-message {
	  padding: 24px;
	  text-align: center;
	  font-size: 18px;
	  color: #555;
	} 
	  
	  </style>	
	
	
	
</head>
<body>
	<!-- Google Tag Manager (noscript) -->
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N67L88MK"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<!-- End Google Tag Manager (noscript) -->

<header>
  <nav class="navbar" id="navbar">
    <div class="logo">
		<a href="index.html" >
			<img src="images/logo.png" alt="Red Rock Logo" />
			<span style="Color:rgba(0,0,0,.8);">Red Rock Party Rentals</span>
		</a>
    </div>
    <button class="menu-toggle" id="menu-toggle" aria-label="Open Menu" style="color:#ccc;">&#9776;</button>
    <ul class="nav-links" id="nav-links">
      <li><a href="index.html" style="color: rgba(0,0,0,.8);">Home</a></li>
      <li><a href="rentals.html" style="color: rgba(0,0,0,.8);">Rentals</a></li>
      <li><a href="book.html" style="color: rgba(0,0,0,.8);">Book</a></li>
      <li><a href="contact.html" style="color: rgba(0,0,0,.8);">Contact</a></li>
    </ul>
  </nav>
</header>

<!--
  <section class="hero">
    <div class="overlay">
      <div class="hero-text">
        <h1>Book</h1>
      </div>
    </div>
  </section>
-->
	<div class="page-wrapper">
	
			  <div style="font-size: 30px;text-align: center;">
				When is your event?
			  </div>
			  
		<section class="booking-form" style="padding-top: margin:auto;">
			<div class="form-section">
				<form class="form-container" style="display:flex; flex-wrap:wrap;gap:1rem;">
				  <div class="dropdown-wrapper">
					<div class="dropdown-icon-calendar"></div>
					<div class="dropdown-divider"></div>
					<input type="text" id="dateStart" placeholder="Event Date" required>
				  </div>
				  <button id="findRentalsBtn" type="button" class="find-rentals-btn">SEE AVAILABLE RENTALS ‚Üí</button>
				</form>
			</div>
		</section>
	  

		<!-- Inventory Grid -->
		<section class="rr-inventory-section">

			<div class="accordion" id="inventoryAccordion" data-loading="true">

			  <div id="inventoryLoading" class="checking-availability-message">
				To get started, please enter your event date
			  </div>
			  
			  <div id="selectYourRentalsHeader" style="display:none;font-size: 30px;text-align: center;">
				Select your rentals
			  </div>

			  <div class="accordion-item" data-category="Tables And Chairs">
				<button class="accordion-header">
				  Tables & Chairs
				  <span class="accordion-icon">+</span>
				</button>
				<div class="accordion-content">
				  <div class="rr-inventory-grid"></div>
				</div>
			  </div>

			  <div class="accordion-item" data-category="Table Covers">
				<button class="accordion-header">
				  Table Covers
				  <span class="accordion-icon">+</span>
				</button>
				<div class="accordion-content">
				  <div class="rr-inventory-grid"></div>
				</div>
			  </div>

			  <div class="accordion-item" data-category="Table Runners">
				<button class="accordion-header">
				  Table Runners
				  <span class="accordion-icon">+</span>
				</button>
				<div class="accordion-content">
				  <div class="rr-inventory-grid"></div>
				</div>
			  </div>
			  
			  <div class="accordion-item" data-category="Games">
				<button class="accordion-header">
				  Games
				  <span class="accordion-icon">+</span>
				</button>
				<div class="accordion-content">
				  <div class="rr-inventory-grid"></div>
				</div>
			  </div>

			  <div class="accordion-item" data-category="Other">
				<button class="accordion-header">
				  Party Essentials
				  <span class="accordion-icon">+</span>
				</button>
				<div class="accordion-content">
				  <div class="rr-inventory-grid"></div>
				</div>
			  </div>

			</div>
					  
		  
		</section>

		<!-- Card Template (hidden) -->
		<template id="rrItemTemplate">
		  <div class="rr-card">
			<div class="rr-card__img-wrap">
			  <img class="rr-card__img" alt="" loading="lazy" />
			</div>

			<div class="rr-card__body">
			  <div class="rr-card__name"></div>
			  <div class="rr-card__addToCart"></div>
			</div>
		  </div>
		</template>
	  
	  
		
		<br>
	  <hr class="solid">

	  <section class="booking">
		<h3>Other Ways to Book:</h3>
		<p>Email us at booking@redrockpartyrentals.com</p>
		<p>Text us at 702-706-2455</p>
	  </section>
	
	</div>
	
	
	<!-- CART OVERLAY -->
	<div id="cartOverlay" class="cart-overlay">
	  <div class="cart-panel cart-panel--fullscreen">

		<header class="cart-header">
		  <button class="cart-back" style="font-size:30px;" onclick="closeCart()">‚Üê</button>
		  <h2 style="margin-bottom:0;font-size:2em;">Cart</h2>
		  <button class="cart-close" onclick="closeCart()">‚úï</button>
		</header>

		<div id="cartItems" class="cart-items"></div>

		<footer class="cart-footer">
		  <div class="cart-summary">
			<div class="cart-line">
			  <span>Delivery</span>
			  <strong id="cartSubtotal">$10.00</strong>
			</div>
			<div class="cart-line total">
			  <span>Total</span>
			  <strong id="cartTotal">$0.00</strong>
			</div>
		  </div>

		  <button class="checkout-btn" onclick="goToCheckout()">Checkout ‚Üí</button>
		</footer>

	  </div>
	</div>


	
	
	
	
<!-- <script src="navbar-scroll.js"></script> -->
<script>
  // Hamburger toggle
  const menuToggle = document.getElementById('menu-toggle');
  const navLinks = document.getElementById('nav-links');
  menuToggle.addEventListener('click', () => {
    navLinks.classList.toggle('open');
  });

  // Optional: Close nav when link is clicked (mobile)
  document.querySelectorAll('.nav-links a').forEach(link => {
    link.addEventListener('click', () => {
      navLinks.classList.remove('open');
    });
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<!-- according js -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const accordionItems = document.querySelectorAll('.accordion-item');

  accordionItems.forEach(item => {
    const header = item.querySelector('.accordion-header');

    header.addEventListener('click', () => {
      item.classList.toggle('open');
    });
  });
});
</script>




<script>
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 1);
  flatpickr("#dateStart", {
	disableMobile: true,
    dateFormat: "m/d/Y",
    minDate: tomorrow
  });
</script>



<!-- INVENTORY GRID JS -->
<script>
  (function () {
  
	const params = new URLSearchParams(window.location.search);
	window.categoryParam = params.get('category'); // "tents"
	window.dateParamRaw = params.get('date');         // "01/22/2026" (decoded automatically)
	window.dateParam = formatDateToISO(dateParamRaw);
	console.log('Category:', window.categoryParam);
	console.log('Date:', window.dateParam);  
  
  
    const ENDPOINT =
	  "https://script.google.com/macros/s/AKfycbwiQbTdtwT0VtIIxGVDnu1IP9q6JXnL6zIhWe7wsnM2O9laf4OProuyfzi9PafriDEoUw/exec?action=availability&date="+window.dateParam;
	
    const grid = document.getElementById("rrInventoryGrid");
    const tpl = document.getElementById("rrItemTemplate");

    const money = (value) => {
      const n = Number(value);
      if (!Number.isFinite(n)) return "";
      // If you want always "$X" (no decimals):
      return "$" + (Number.isInteger(n) ? n : n.toFixed(2));
    };

    const safeText = (v) => (v == null ? "" : String(v));


	function smoothScrollToSelectHeader() {
	  const header = document.getElementById('selectYourRentalsHeader');
	  if (!header) return;

	  // Small delay so layout + accordion DOM settles
	  setTimeout(() => {
		header.scrollIntoView({
		  behavior: 'smooth',
		  block: 'start'
		});
	  }, 200);
	}

	
	async function loadInventory() {

	  const loadingEl = document.getElementById('inventoryLoading');
	  loadingEl.style.display = 'block';
	  loadingEl.textContent = 'Checking availability‚Ä¶';

	  try {
		const res = await fetch(ENDPOINT, { cache: "no-store" });
		if (!res.ok) throw new Error("HTTP " + res.status);

		const data = await res.json();
		if (!data || !Array.isArray(data.items)) {
		  throw new Error("Unexpected response shape");
		}

		loadingEl.style.display = 'none'; // üëà hide loading
		const selectYourRentalsHeaderEl = document.getElementById('selectYourRentalsHeader');
		selectYourRentalsHeaderEl.style.display = 'block';
		const accordionEl = document.getElementById('inventoryAccordion');
		accordionEl.removeAttribute('data-loading');
		renderInventory(data.items);
		smoothScrollToSelectHeader();

	  } catch (err) {
		console.error(err);
		loadingEl.textContent = 'Unable to load availability.';
	  }
	}

	function renderInventory(items) {

	  // Clear all accordion grids
	  document.querySelectorAll('.accordion-item .rr-inventory-grid')
		.forEach(grid => grid.innerHTML = '');

	  items.forEach(item => {
		const category = item.category;

		const accordionItem = document.querySelector(
		  `.accordion-item[data-category="${category}"]`
		);

		// Skip items with no matching accordion
		if (!accordionItem) return;

		const grid = accordionItem.querySelector('.rr-inventory-grid');
		const node = tpl.content.firstElementChild.cloneNode(true);

		const name = safeText(item.item_name);
		const price = money(item.rental_price);
		const qty = Number(item.available_qty);
		const imgUrl = safeText(item.image);

		node.querySelector('.rr-card__img').src = imgUrl;
		node.querySelector('.rr-card__img').alt = name;
		node.querySelector('.rr-card__name').textContent = `${name} - ${price}`;

		const addToCartEl = node.querySelector('.rr-card__addToCart');

		if (qty <= 0) {
		  addToCartEl.innerHTML = `<button disabled>Unavailable</button>`;
		} else {
		  addToCartEl.innerHTML = `<button class="rr-btn-addToCart">Add To Cart</button>`;
		  addToCartEl.querySelector('button').onclick = () =>
			addToCart({
			  id: item.product_id || item.item_id,
			  product_id: item.product_id || item.item_id,
			  name,
			  price: Number(item.rental_price),
			  image: imgUrl,
			  availableQty: qty
			});
		}

		grid.appendChild(node);
	  });
	}

	
	function formatDateToISO(dateStr) {
	  // expects MM/DD/YYYY
	  const [month, day, year] = dateStr.split('/');
	  return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
	}

    // Kick off
    loadInventory();
  })();
</script>


<!-- CART JS -->
<script>
const CART_KEY = 'rrpr_cart';

/* --------------------
   Core helpers
-------------------- */
function getCart() {
  return JSON.parse(localStorage.getItem(CART_KEY)) || [];
}

function saveCart(cart) {
  localStorage.setItem(CART_KEY, JSON.stringify(cart));
}

/* --------------------
   Cart actions
-------------------- */
function addToCart(item) {
  const cart = getCart();
  const existing = cart.find(i => i.id === item.id);

	if (existing) {
	  if (existing.qty < existing.availableQty) {
		existing.qty += 1;
	  } else {
		alert(`Only ${existing.availableQty} available for this item.`);
		return;
	  }
	} else {
	  cart.push({ ...item, qty: 1 });
	}

  saveCart(cart);
  openCart();
  renderCart();
}

function removeFromCart(id) {
  const cart = getCart().filter(i => i.id !== id);
  saveCart(cart);
  renderCart();
}



function updateQty(id, delta) {
  const cart = getCart();
  const item = cart.find(i => i.id === id);
  if (!item) return;

  const nextQty = item.qty + delta;

  if (nextQty < 1) {
    removeFromCart(id);
    return;
  }

  if (nextQty > item.availableQty) {
    alert(`Only ${item.availableQty} available for this item.`);
    return;
  }

  item.qty = nextQty;
  saveCart(cart);
  renderCart();
}





function commitQty(id, value) {
  let qty = parseInt(value, 10);

  if (!Number.isFinite(qty) || qty < 1) {
    qty = 1;
  }

  const cart = getCart();
  const item = cart.find(i => i.id === id);
  if (!item) return;

  if (qty > item.availableQty) {
    alert(`Only ${item.availableQty} available for this item.`);
    qty = item.availableQty;
  }

  // No-op if unchanged
  if (item.qty === qty) return;

  item.qty = qty;
  saveCart(cart);
  renderCart();
}




/* --------------------
   Render
-------------------- */
function renderCart() {
  const cart = getCart();
  const container = document.getElementById("cartItems");
  const subtotalEl = document.getElementById("cartSubtotal");
  const totalEl = document.getElementById("cartTotal");

  container.innerHTML = "";
  let subtotal = 0;

  cart.forEach(item => {
    const itemTotal = item.price * item.qty;
    subtotal += itemTotal;

    const row = document.createElement("div");
    row.className = "cart-item";

    row.innerHTML = `
		<div class="cart-item-info-header">
		  <img src="${item.image}" alt="">
		  <div class="cart-item-info">
			<div class="cart-item-info-name">${item.name}</div>
			<div class="cart-price">$${item.price.toFixed(2)}</div>
			<div style="font-size:16px;">${item.availableQty} available </div>
		  </div>
		  <button class="cart-delete" onclick="removeFromCart('${item.id}')">
			üóë
		  </button>		  
		</div>
		
		<div class="cart-item-footer-container">
			<label style="color:#505050;">Quantity</label>
			<div class="cart-item-info-footer">
			  <div class="cart-qty">
				<button onclick="updateQty('${item.id}', -1)">‚àí</button>
					<input
					  type="number"
					  min="1"
					  step="1"
					  value="${item.qty}"
					  class="cart-qty-input"
					  onblur="commitQty('${item.id}', this.value)"
					  onkeydown="if (event.key === 'Enter') this.blur()"
					/>
				<button onclick="updateQty('${item.id}', 1)">+</button>
			  </div>

			  <div class="cart-item-total">
				$${itemTotal.toFixed(2)}
			  </div>


			</div>
		</div>
    `;

    container.appendChild(row);
  });

  //subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
  const grandtotal = subtotal + 10;
  totalEl.textContent = `$${grandtotal.toFixed(2)}`;
}

/* --------------------
   Open / Close
-------------------- */
function openCart() {
  document.getElementById("cartOverlay").classList.add("open");
  document.body.style.overflow = "hidden";
}

function closeCart() {
  const overlay = document.getElementById("cartOverlay");

  overlay.classList.remove("open");
  overlay.classList.add("closing");

  document.body.style.overflow = "";

  // Wait for the slide animation to finish
  setTimeout(() => {
    overlay.classList.remove("closing");
  }, 400); // match CSS transition duration
}

/* Close when clicking backdrop */
document.getElementById('cartOverlay').addEventListener('click', e => {
  if (e.target.id === 'cartOverlay') closeCart();
});

/* Init */
renderCart();
</script>

<!--Auto Populate Form Values from URL Params -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
	
    /* ---------- Category ---------- */
    if (window.categoryParam) {
      const categorySelect = document.getElementById('category');

      if (categorySelect) {
        // Only set if option exists
        const optionExists = Array.from(categorySelect.options)
          .some(opt => opt.value === window.categoryParam);

        if (optionExists) {
          categorySelect.value = window.categoryParam;
        }
      }
    }

    /* ---------- Date ---------- */
    if (window.dateParam) {
	  const desktopInput = document.getElementById('dateStart');
	  if (desktopInput) {
		desktopInput.value = window.dateParamRaw;
	  }

	  // Mobile (native date input)
	  const mobileInput = document.querySelector('.flatpickr-mobile');
	  if (mobileInput) {
		mobileInput.value = window.dateParam;
	  }
    }
  });
</script>


<!-- When user clicks Find My Rentals button -->
<script>
  document.getElementById('findRentalsBtn').addEventListener('click', function () {
    const category = 'Everything';
    const date = document.getElementById('dateStart').value;

	if (!category) {
		category = 'Everything';
	}
    if (!date) {
      alert('Please select event date.');
      return;
    }

    const params = new URLSearchParams({
      category: category,
      date: date
    });
	
	localStorage.setItem('rrpr_event_date',JSON.stringify(date));

    window.location.href = `/book11.html?${params.toString()}`;
  });
</script>



<script>
function goToCheckout() {
  closeCart();
  window.location.href = "/checkout";
}
</script>




</body>
</html>
